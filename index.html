<!doctype html>
<html>
<head>
	<meta charset='utf-8'/>
	<style>
		* {
			box-sizing: border-box;
		}
		html {
			margin: 0;
			padding: 0;
			height:100%;
		}
		body {
			padding:40px 10px;
			margin:0;
			background-image: url('lib/brown-felt-background.png');
			height:100%;
			box-shadow: inset 0 0 3px 5px hsla(30,50%,10%,0.3);
			font-family: arial;
			font-size: 16px;
			color: hsl(30,30%,15%);
		}
		.panel {
			margin: 80px auto;
			width: 500px;
			border-top: solid 1px hsl(30,80%,50%);
			box-shadow: inset 0 4px 3px hsla(30,80%,50%,0.3),
						inset 0 -2px 2px 1px hsla(30,80%,50%,0.2),
						0 1px 2px 1px hsla(30,50%,10%,0.3);
			background: hsla(30,80%,50%,0.1);
			padding: 8px;
			border-radius: 8px;
		}
		.sentence {
			display:block;
			padding: 0;
			border-radius:2px;
			margin-bottom: 4px;
		}
		.date {
			float:right;
			color: hsl(35,40%,60%);
			display:block;
			font-size: 12px;
		}
		i {
			white-space: nowrap;
			font-style: normal;
			color: hsl(30,50%,30%);
		}
		.row {
			margin: 10px 0;
		}
		.row > * {
			display:inline-block;
			vertical-align:top;
		}
		ul {
			margin:0;
			margin-right: 20px;
			padding:0;
			padding-left: 20px;
		}
	</style>
</head>
<body>
	<div class="panel">
		<div class="date">二零一四年 二月 二日</div>
		<div class="sentence title">今年 我会 好好学 中文.</div>
		<div class="sentence">我是 一位 <i title="Yà yì měiguó rén (Asian American)">亚裔美国人</i>, 来自 开平.</div>
		<div class="sentence">我 很年轻的 来到 美国.</div>
		<div class="sentence">我的 家人 和 我 <i title="jiǎng (speak)">讲</i> <i title="yuèyǔ (Cantonese)">粤语</i>,
			而且 我 在 美国 <i title="cānjiāle (attended)">参加了</i> 两年 <i title="guǎngdōnghuà">广东话</i> 学校.
		</div>
		<div class="sentence">所以 我 比 其他人 在 美国 长大 <i title="Liǎojiě (understand)">了解</i> 多一点 中国文化.</div>
		<div class="sentence">但 二十八岁的我 还是 看不懂 书, 所以 我 决定 今年 一定要 <i title="Xuéhuì (become skilled at)">学会</i> 看书.</div>
		<div class="row">
			<div>
				<i title="Tóng yì zì (synonyms)">同义字</i>:
				<ul>
					<li>明白, 了解</li>
					<li>广东话, 粤语</li>
				</ul>
			</div>
			<div>
				<i title="Liáncí (conjunctions)">连词</i>:
				<ul>
					<li>而且</li>
					<li>所以</li>
					<li>但</li>
				</ul>
			</div>
		</div>
	</div>
	<script type="text/plain">
		[ㄅ 八 b]
		[ㄆ 杷 p]
		[ㄇ 馬 m]
		[ㄈ 法 f]
		[ㄉ 地 d]
		[ㄊ 提 t]
		[ㄋ 乃 n]
		[ㄌ 力 l]
		[ㄍ 告 g]
		[ㄎ 考 k]
		[ㄏ 好 h]
		[ㄐ 叫 j]
		[ㄑ 巧 q]
		[ㄒ 下 x]
		[ㄓ 之 zh]
		[ㄔ 彳 ch]
		[ㄕ 尸 sh]
		[ㄖ 日 r]
		[ㄗ 在 z]
		[ㄘ 才 c]
		[ㄙ 私 s]
	</script>
	<script>
		var ATOM = /^[^\(\)\[\]\s.#]+/,
			SPACES = /^\s*/,
			META_ID = /^#[^\(\)\[\]\s]+/,
			META_CLASSES = /^\.[^\(\)\[\]\s]+/
		function parse(str) {
			var start = skipSpaces(str, 0)
			if (str[start] === '(') return parseExpr('expr', ')', str, start)
			if (str[start] === '[') return parseExpr('seq', ']', str, start)
		}
		function parseExpr(type,close,str, start) {
			var expr = {type:type, start:start, children:[]},
				i = skipSpaces(str, start+1)
			expr.end = i+1
			if (str[i] !== close) {
				expr.children = parseChildren(close, str, i)
				if (expr.children) {
					expr.end = expr.children[expr.children.length-1].end + 1
				}
			}
			parseMeta(expr, str)
			expr.snippet = str.substring(expr.start,expr.end)
			return expr
		}
		function parseChildren(close, str, start) {
			var children,
				child,
				z = str.length
			for (var i=start; i < z;) {
				i = skipSpaces(str, i)
				if (str[i] === close) {
					break;
				} else if (str[i] === '[') {
					child = parseExpr('seq', ']', str, i);
				} else if (str[i] === '(') {
					child = parseExpr('expr', ')', str, i)
				} else {
					child = parseAtom(str, i)
				}
				if (!child) break;
				if (!children) children = [];
				children.push(child)
				i = child.end
			}
			return children
		}
		function parseAtom(str, start) {
			var m = str.substring(start).match(ATOM)
			if (m) {
				var atom = {
					type:'atom',
					start: start,
					end: start + m[0].length,
					value: m[0]
				}
				parseMeta(atom, str)
				atom.snippet = str.substring(atom.start, atom.end)
				return atom
			}
		}
		function parseMeta(node, str) {
			var m = str.substring(node.end).match(META_ID)
			if (m) {
				node.id = m[0].substring(1)
				node.end += m[0].length;
			}
			m = str.substring(node.end).match(META_CLASSES)
			if (m) {
				node.classes = m[0].substring(1).split('.')
				node.end += m[0].length;
			}
		}
		function skipSpaces(str, start) {
			return start + str.substring(start).match(SPACES)[0].length
		}

		console.warn(JSON.stringify(parse('(table (combine.later.blah tr [split 3 td] []#triplets))'),null,4))
	</script>
</body>
</html>
